<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Teor√≠a de Colas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .input-section, .results-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
        }

        .input-section h2, .results-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .model-selector {
            margin-bottom: 25px;
        }

        .model-selector label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .model-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .model-selector select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-description {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .result-item {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }

        .result-item:hover {
            transform: translateX(5px);
        }

        .result-label {
            font-weight: 600;
            color: #333;
        }

        .result-value {
            font-size: 1.3em;
            color: #667eea;
            font-weight: 700;
        }

        .error-message {
            background: #ff4757;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .warning-message {
            background: #ffa502;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .probability-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #ddd;
        }

        .probability-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        @media (max-width: 968px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .formula-info {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.85em;
            color: #1565c0;
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Calculadora de Teor√≠a de Colas</h1>
            <p>Modelos M/M/1 y M/M/k con Medidas de Desempe√±o</p>
        </div>

        <div class="content">
            <div class="input-section">
                <h2>Par√°metros de Entrada</h2>
                
                <div id="errorMsg" class="error-message"></div>
                <div id="warningMsg" class="warning-message"></div>

                <div class="model-selector">
                    <label for="model">Seleccionar Modelo:</label>
                    <select id="model" onchange="toggleModel()">
                        <option value="mm1">M/M/1 (Un servidor)</option>
                        <option value="mmk">M/M/k (M√∫ltiples servidores)</option>
                    </select>
                </div>

                <div class="input-group" id="kGroup" style="display: none;">
                    <label for="k">N√∫mero de Servidores (k):</label>
                    <input type="number" id="k" value="3" min="1" step="1">
                    <div class="input-description">Cantidad de servidores en paralelo</div>
                </div>

                <div class="input-group">
                    <label for="lambda">Tasa de Llegada (Œª):</label>
                    <input type="number" id="lambda" value="4" min="0" step="0.1">
                    <div class="input-description">Clientes que llegan por unidad de tiempo</div>
                </div>

                <div class="input-group">
                    <label for="mu">Tasa de Servicio (Œº):</label>
                    <input type="number" id="mu" value="5" min="0" step="0.1">
                    <div class="input-description">Clientes atendidos por servidor por unidad de tiempo</div>
                </div>

                <div class="probability-section">
                    <h3>Probabilidades Espec√≠ficas (Opcional)</h3>
                    
                    <div class="input-group">
                        <label for="n">N√∫mero de clientes (n) para P(n):</label>
                        <input type="number" id="n" value="3" min="0" step="1">
                        <div class="input-description">Calcular probabilidad de tener exactamente n clientes</div>
                    </div>

                    <div class="input-group">
                        <label for="nMax">N√∫mero m√°ximo para P(‚â§n):</label>
                        <input type="number" id="nMax" value="3" min="0" step="1">
                        <div class="input-description">Calcular probabilidad de tener a lo m√°s n clientes</div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculate()">üî¨ Calcular Medidas de Desempe√±o</button>

                <div class="formula-info">
                    <strong>Nota:</strong> El sistema debe estar en estado estacionario.<br>
                    ‚Ä¢ M/M/1: Œª < Œº<br>
                    ‚Ä¢ M/M/k: Œª < k¬∑Œº
                </div>
            </div>

            <div class="results-section">
                <h2>Resultados</h2>
                <div id="results">
                    <p style="text-align: center; color: #999; padding: 50px 20px;">
                        Ingrese los par√°metros y presione "Calcular" para ver los resultados
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleModel() {
            const model = document.getElementById('model').value;
            const kGroup = document.getElementById('kGroup');
            
            if (model === 'mmk') {
                kGroup.style.display = 'block';
            } else {
                kGroup.style.display = 'none';
            }
        }

        function factorial(n) {
            if (n <= 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }

        function calculateMM1(lambda, mu, n, nMax) {
            const rho = lambda / mu;
            
            // Medidas b√°sicas
            const P0 = 1 - rho;
            const Pn = (1 - rho) * Math.pow(rho, n);
            const Ls = lambda / (mu - lambda);
            const Lq = (lambda * lambda) / (mu * (mu - lambda));
            const Ws = 1 / (mu - lambda);
            const Wq = lambda / (mu * (mu - lambda));
            const Pw = lambda / mu;

            // P(‚â§n)
            let PnMax = 0;
            for (let i = 0; i <= nMax; i++) {
                PnMax += (1 - rho) * Math.pow(rho, i);
            }

            return { P0, Pn, Ls, Lq, Ws, Wq, Pw, rho, PnMax };
        }

        function calculateMMk(k, lambda, mu, n, nMax) {
            const rho = lambda / (k * mu);
            const rhoK = lambda / mu;
            
            // Calcular P0
            let sum = 0;
            for (let i = 0; i <= k - 1; i++) {
                sum += Math.pow(rhoK, i) / factorial(i);
            }
            const P0 = 1 / (sum + (Math.pow(rhoK, k) / (factorial(k) * (1 - rho))));

            // Calcular Pn
            let Pn;
            if (n <= k) {
                Pn = (Math.pow(rhoK, n) / factorial(n)) * P0;
            } else {
                Pn = (Math.pow(rho, n) * Math.pow(k, k) / factorial(k)) * P0;
            }

            // Lq
            const Lq = (Math.pow(rho, k + 1) * Math.pow(k, k - 1) / (factorial(k - 1) * Math.pow(1 - rho, 2))) * P0;
            
            // Ls
            const Ls = Lq + rhoK;
            
            // Wq
            const Wq = Lq / lambda;
            
            // Ws
            const Ws = Wq + (1 / mu);
            
            // Pw
            const Pw = (1 / factorial(k)) * Math.pow(lambda / mu, k) * (k * mu / (k * mu - lambda)) * P0;

            // P(‚â§nMax)
            let PnMax = 0;
            for (let i = 0; i <= nMax; i++) {
                if (i <= k) {
                    PnMax += (Math.pow(rhoK, i) / factorial(i)) * P0;
                } else {
                    PnMax += (Math.pow(rho, i) * Math.pow(k, k) / factorial(k)) * P0;
                }
            }

            return { P0, Pn, Ls, Lq, Ws, Wq, Pw, rho, PnMax };
        }

        function calculate() {
            // Limpiar mensajes
            document.getElementById('errorMsg').style.display = 'none';
            document.getElementById('warningMsg').style.display = 'none';

            // Obtener valores
            const model = document.getElementById('model').value;
            const lambda = parseFloat(document.getElementById('lambda').value);
            const mu = parseFloat(document.getElementById('mu').value);
            const n = parseInt(document.getElementById('n').value);
            const nMax = parseInt(document.getElementById('nMax').value);
            const k = model === 'mmk' ? parseInt(document.getElementById('k').value) : 1;

            // Validaciones
            if (isNaN(lambda) || isNaN(mu) || lambda <= 0 || mu <= 0) {
                showError('Por favor, ingrese valores v√°lidos para Œª y Œº (mayores que 0)');
                return;
            }

            // Verificar estado estacionario
            if (model === 'mm1' && lambda >= mu) {
                showError('El sistema NO est√° en estado estacionario. Debe cumplirse: Œª < Œº');
                return;
            }

            if (model === 'mmk' && lambda >= k * mu) {
                showError(`El sistema NO est√° en estado estacionario. Debe cumplirse: Œª < k¬∑Œº (${lambda} < ${k * mu})`);
                return;
            }

            // Calcular seg√∫n modelo
            let results;
            if (model === 'mm1') {
                results = calculateMM1(lambda, mu, n, nMax);
            } else {
                results = calculateMMk(k, lambda, mu, n, nMax);
            }

            // Mostrar advertencia si œÅ est√° cerca del l√≠mite
            if (results.rho > 0.9) {
                showWarning('‚ö†Ô∏è Advertencia: œÅ > 0.9 indica un sistema muy congestionado. Los tiempos de espera ser√°n largos.');
            }

            // Mostrar resultados
            displayResults(results, model, k, n, nMax);
        }

        function displayResults(results, model, k, n, nMax) {
            const resultsDiv = document.getElementById('results');
            
            const modelName = model === 'mm1' ? 'M/M/1' : `M/M/${k}`;
            
            resultsDiv.innerHTML = `
                <div style="background: #667eea; color: white; padding: 10px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                    <strong>Modelo: ${modelName}</strong>
                </div>

                <div class="result-item">
                    <span class="result-label">œÅ (Utilizaci√≥n del servidor)</span>
                    <span class="result-value">${results.rho.toFixed(4)}</span>
                </div>

                <div class="result-item">
                    <span class="result-label">P‚ÇÄ (Sistema vac√≠o)</span>
                    <span class="result-value">${results.P0.toFixed(4)}</span>
                </div>

                <div class="result-item">
                    <span class="result-label">P(${n}) (Exactamente ${n} clientes)</span>
                    <span class="result-value">${results.Pn.toFixed(6)}</span>
                </div>

                <div class="result-item">
                    <span class="result-label">P(‚â§${nMax}) (A lo m√°s ${nMax} clientes)</span>
                    <span class="result-value">${results.PnMax.toFixed(6)}</span>
                </div>

                <div class="result-item">
                    <span class="result-label">L‚Çõ (Clientes en el sistema)</span>
                    <span class="result-value">${results.Ls.toFixed(4)}</span>
                </div>

                <div class="result-item">
                    <span class="result-label">Lq (Clientes en la cola)</span>
                    <span class="result-value">${results.Lq.toFixed(4)}</span>
                </div>

                <div class="result-item">
                    <span class="result-label">W‚Çõ (Tiempo en el sistema)</span>
                    <span class="result-value">${results.Ws.toFixed(4)}</span>
                </div>

                <div class="result-item">
                    <span class="result-label">Wq (Tiempo en la cola)</span>
                    <span class="result-value">${results.Wq.toFixed(4)}</span>
                </div>

                <div class="result-item">
                    <span class="result-label">Pw (Prob. de esperar)</span>
                    <span class="result-value">${results.Pw.toFixed(4)}</span>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                    <strong style="color: #2e7d32;">Interpretaci√≥n:</strong><br>
                    ‚Ä¢ En promedio hay ${results.Ls.toFixed(2)} clientes en el sistema<br>
                    ‚Ä¢ En promedio hay ${results.Lq.toFixed(2)} clientes esperando<br>
                    ‚Ä¢ Tiempo promedio en el sistema: ${results.Ws.toFixed(2)} unidades<br>
                    ‚Ä¢ Tiempo promedio de espera: ${results.Wq.toFixed(2)} unidades<br>
                    ‚Ä¢ Probabilidad de esperar: ${(results.Pw * 100).toFixed(2)}%<br>
                    ‚Ä¢ Utilizaci√≥n del servidor: ${(results.rho * 100).toFixed(2)}%
                </div>
            `;
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.style.display = 'block';
            document.getElementById('results').innerHTML = `
                <p style="text-align: center; color: #ff4757; padding: 50px 20px;">
                    ${message}
                </p>
            `;
        }

        function showWarning(message) {
            const warningDiv = document.getElementById('warningMsg');
            warningDiv.textContent = message;
            warningDiv.style.display = 'block';
        }
    </script>
</body>
</html>